#!/bin/bash

function makelink {
    target=$1
    link_name=$2

    echo "installing $target to $link_name"
    ln -s $target $link_name 
}

# since readlink -f doesn't work in osx
function abspath() {
    [[ $1 = /* ]] && echo "$1" || echo "$PWD/${1#./}"
}

#backup old stuff
files=( .vimrc .vim .gitconfig .bashrc .bash .irbrc .ackrc .screenrc bin )
for file in "${files[@]}"; do
    if [ -e ~/$file ]; then
        echo "$file exists"
        mv ~/$file ~/$file.$$.bak
    elif [ -h ~/$file ]; then
        echo "symlink $file exists"
        rm -f ~/$file
    fi
done

cur=$(dirname "$(abspath $0)")

makelink $cur/vimrc    ~/.vimrc
makelink $cur/dotvim   ~/.vim 
makelink $cur/bashrc   ~/.bashrc
makelink $cur/bash     ~/.bash
makelink $cur/irbrc    ~/.irbrc
makelink $cur/ackrc    ~/.ackrc
makelink $cur/screenrc ~/.screenrc
makelink $cur/bin      ~/bin

#github config
github_token='/etc/github_pass'
if [ -f $github_token ]; then
    token=$(cat $github_token)
    sed "s/__GITHUB_TOKEN__/$token/" < $cur/gitconfig.tmpl > $cur/gitconfig 
    makelink $cur/gitconfig ~/.gitconfig
else 
    echo "install $github_token for gitconfig" 
fi

